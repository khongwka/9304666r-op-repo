pipeline {
    agent any

    stages {
        stage('Run and Verify Web Test') {
            steps {
                script {
                    // Step 1: Run the required command, writing to /tmp.
                    sh 'curl -Is http://localhost:33200 | head -n 1 > /tmp/qa-result-file || true'

                    // Step 2: Read the result file from /tmp.
                    def result = readFile('/tmp/qa-result-file').trim()

                    // Step 3: Check the result.
                    if (result.contains('200 OK')) {
                        echo "Web test successful: ${result}"
                    } else {
                        error("Web test FAILED. Server response was: '${result}'")
                    }
                }
            }
        }
    }
}
